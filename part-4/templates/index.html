<!DOCTYPE html>
<html>
<head>
    <title>Book Inventory Manager</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body class="bg-dark text-white p-4">
<div class="container">

    <h1 class="text-danger mb-4">ðŸ“š Book Inventory Manager</h1>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for msg in messages %}
                <div class="alert alert-success">{{ msg }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- ================= ADD AUTHOR ================= -->
    <h3>Add Author</h3>
    <form action="{{ url_for('add_author') }}" method="POST" class="mb-4">
        <input type="text" name="name"
               class="form-control w-25 d-inline"
               placeholder="Author Name" required>
        <input type="text" name="bio"
               class="form-control w-25 d-inline"
               placeholder="Bio">
        <input type="text" name="city"
               class="form-control w-25 d-inline"
               placeholder="City">
        <button class="btn btn-success">Add Author</button>
    </form>

    <!-- ================= EDIT AUTHOR (INLINE) ================= -->
    {% if edit_author %}
    <h3 class="text-warning">Edit Author</h3>
    <form method="POST"
          action="{{ url_for('update_author', id=edit_author.id) }}"
          class="mb-4">
        <input type="text" name="name"
               value="{{ edit_author.name }}"
               class="form-control w-25 d-inline" required>
        <input type="text" name="bio"
               value="{{ edit_author.bio }}"
               class="form-control w-25 d-inline">
        <input type="text" name="city"
               value="{{ edit_author.city }}"
               class="form-control w-25 d-inline">
        <button class="btn btn-warning">Update</button>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancel</a>
    </form>
    {% endif %}

    <!-- ================= AUTHORS LIST ================= -->
    <h4>Authors List</h4>
    <table class="table table-dark table-striped mb-5">
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Bio</th>
            <th>City</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for author in authors %}
        <tr>
            <td>{{ author.id }}</td>
            <td>{{ author.name }}</td>
            <td>{{ author.bio }}</td>
            <td>{{ author.city }}</td>
            <td>
                <a href="{{ url_for('index', edit_author=author.id) }}"
                   class="btn btn-primary btn-sm">Edit</a>

                <a href="{{ url_for('delete_author', id=author.id) }}"
                   class="btn btn-danger btn-sm"
                   onclick="return confirm('Delete this author?');">
                   Delete
                </a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- ================= ADD BOOK ================= -->
    <h3>Add Book</h3>
    <form action="{{ url_for('add_book') }}" method="POST" class="mb-4">
        <input type="text" name="title"
               class="form-control w-25 d-inline"
               placeholder="Title" required>

        <input type="text" name="isbn"
               class="form-control w-25 d-inline"
               placeholder="ISBN" required>

        <select name="author_id"
                class="form-select w-25 d-inline" required>
            <option value="">Select Author</option>
            {% for author in authors %}
                <option value="{{ author.id }}">{{ author.name }}</option>
            {% endfor %}
        </select>

        <button class="btn btn-success">Add Book</button>
    </form>

    <!-- ================= EDIT BOOK (INLINE) ================= -->
    {% if edit_book %}
    <h3 class="text-warning">Edit Book</h3>
    <form method="POST"
          action="{{ url_for('update_book', id=edit_book.id) }}"
          class="mb-4">

        <input type="text" name="title"
               value="{{ edit_book.title }}"
               class="form-control w-25 d-inline" required>

        <input type="text" name="isbn"
               value="{{ edit_book.isbn }}"
               class="form-control w-25 d-inline" required>

        <select name="author_id"
                class="form-select w-25 d-inline" required>
            {% for author in authors %}
                <option value="{{ author.id }}"
                    {% if author.id == edit_book.author_id %}selected{% endif %}>
                    {{ author.name }}
                </option>
            {% endfor %}
        </select>

        <button class="btn btn-warning">Update</button>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancel</a>
    </form>
    {% endif %}

    <!-- ================= BOOKS LIST ================= -->
    <h4>Books List</h4>
    <table class="table table-dark table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>ISBN</th>
            <th>Author</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for book in books %}
        <tr>
            <td>{{ book.id }}</td>
            <td>{{ book.title }}</td>
            <td>{{ book.isbn }}</td>
            <td>{{ book.author.name }}</td>
            <td>
                <a href="{{ url_for('index', edit_book=book.id) }}"
                   class="btn btn-primary btn-sm">Edit</a>

                <a href="{{ url_for('delete_book', id=book.id) }}"
                   class="btn btn-danger btn-sm"
                   onclick="return confirm('Delete this book?');">
                   Delete
                </a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

</div>
</body>
</html>
